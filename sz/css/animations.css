/* ==========================================================================
   Animations & Transitions
   Lightweight, GPU-accelerated animations for the SZ desktop environment.
   All durations are kept short (<=250ms) to feel snappy.
   Animations can be globally disabled by adding .sz-animations-off to <html>.
   ========================================================================== */

/* --------------------------------------------------------------------------
   Window Open
   Scales up from 95% with a fade-in.
   -------------------------------------------------------------------------- */

.sz-window {
  animation: sz-window-open 0.15s ease-out;
}

@keyframes sz-window-open {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: none;
  }
}

/* --------------------------------------------------------------------------
   Window Close
   Instant removal -- no animation (Windows XP style).
   The sz-closing class is set by JS; pointer-events disabled so the dying
   window cannot be interacted with during the brief cleanup frame.
   -------------------------------------------------------------------------- */

.sz-window.sz-closing {
  pointer-events: none;
}

/* --------------------------------------------------------------------------
   Minimize (shrink + fade toward the corresponding taskbar button)
   --sz-anim-tx / --sz-anim-ty are set by JS to the offset from the
   window's current left/top position to the taskbar button center.
   -------------------------------------------------------------------------- */

.sz-window.sz-minimizing {
  animation: sz-window-minimize 0.2s cubic-bezier(0.4, 0, 1, 1) forwards;
  pointer-events: none;
}

@keyframes sz-window-minimize {
  to {
    opacity: 0;
    transform: translate3d(var(--sz-anim-tx, 0px), var(--sz-anim-ty, 100vh), 0) scale(0.2, 0.1);
  }
}

/* --------------------------------------------------------------------------
   Restore from Minimize (expand from taskbar button to window position)
   The "from" values match where minimize ended so the reverse feels natural.
   -------------------------------------------------------------------------- */

.sz-window.sz-restoring-from-min {
  animation: sz-window-restore-min 0.2s cubic-bezier(0, 0, 0.2, 1);
}

@keyframes sz-window-restore-min {
  from {
    opacity: 0;
    transform: translate3d(var(--sz-anim-tx, 0px), var(--sz-anim-ty, 100vh), 0) scale(0.2, 0.1);
  }
  to {
    opacity: 1;
    transform: none;
  }
}

/* --------------------------------------------------------------------------
   Maximize (grow from current rect to fullscreen)
   Uses a quick scale-up with slight opacity punch.
   -------------------------------------------------------------------------- */

.sz-window.sz-maximizing {
  animation: sz-window-maximize 0.15s cubic-bezier(0, 0, 0.2, 1);
}

@keyframes sz-window-maximize {
  from {
    opacity: 0.85;
  }
  to {
    opacity: 1;
  }
}

/* --------------------------------------------------------------------------
   Restore from Maximize (shrink from fullscreen to windowed rect)
   -------------------------------------------------------------------------- */

.sz-window.sz-restoring-from-max {
  animation: sz-window-restore-max 0.15s cubic-bezier(0, 0, 0.2, 1);
}

@keyframes sz-window-restore-max {
  from {
    opacity: 0.85;
  }
  to {
    opacity: 1;
  }
}

/* --------------------------------------------------------------------------
   Roll Up / Roll Down
   Smooth transition for window shade effect.
   -------------------------------------------------------------------------- */

.sz-window {
  transition: grid-template-rows 0.15s ease, height 0.15s ease;
}

.sz-animations-off .sz-window {
  transition-duration: 0s !important;
}

@media (prefers-reduced-motion: reduce) {
  .sz-window {
    transition-duration: 0.01ms !important;
  }
}

/* --------------------------------------------------------------------------
   Focus Pulse
   Brief highlight when a window receives focus (e.g. clicked in taskbar).
   -------------------------------------------------------------------------- */

.sz-window.sz-focus-pulse {
  animation: sz-focus-pulse 0.2s ease-out;
}

@keyframes sz-focus-pulse {
  0%   { filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.35)) brightness(1.08); }
  100% { filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.35)) brightness(1); }
}

/* --------------------------------------------------------------------------
   Start Menu
   Slides up from the taskbar edge.
   -------------------------------------------------------------------------- */

#sz-start-menu.open {
  animation: sz-start-menu-open 0.12s ease-out;
}

@keyframes sz-start-menu-open {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

#sz-start-menu.closing {
  animation: sz-start-menu-close 0.1s ease-in forwards;
}

@keyframes sz-start-menu-close {
  to {
    opacity: 0;
    transform: translateY(8px);
  }
}

/* --------------------------------------------------------------------------
   Desktop Icon Selection
   Smooth background fade on hover / select.
   -------------------------------------------------------------------------- */

.sz-icon {
  transition: background-color 0.1s ease, border-color 0.1s ease;
}

/* --------------------------------------------------------------------------
   Taskbar Button Press
   -------------------------------------------------------------------------- */

.sz-taskbar-button {
  transition: background-color 0.08s ease;
}

/* --------------------------------------------------------------------------
   Utility: prevent animations during initial page load to avoid a flash of
   all windows animating in at once. JS removes this class after DOMReady.
   -------------------------------------------------------------------------- */

.sz-no-animate,
.sz-no-animate * {
  animation-duration: 0s !important;
  transition-duration: 0s !important;
}

/* --------------------------------------------------------------------------
   Animations disabled (user toggle in Control Panel)
   When .sz-animations-off is on <html>, all window and UI animations are
   suppressed.  JS still adds/removes animation classes, but the durations
   are zero so animationend fires immediately.
   -------------------------------------------------------------------------- */

.sz-animations-off .sz-window,
.sz-animations-off .sz-window.sz-minimizing,
.sz-animations-off .sz-window.sz-restoring-from-min,
.sz-animations-off .sz-window.sz-restoring-from-max,
.sz-animations-off .sz-window.sz-maximizing,
.sz-animations-off .sz-window.sz-focus-pulse,
.sz-animations-off #sz-start-menu.open,
.sz-animations-off #sz-start-menu.closing {
  animation-duration: 0s !important;
}

.sz-animations-off .sz-icon,
.sz-animations-off .sz-taskbar-button {
  transition-duration: 0s !important;
}

/* --------------------------------------------------------------------------
   Reduced Motion
   Respect the user's OS-level preference for reduced motion.
   -------------------------------------------------------------------------- */

@media (prefers-reduced-motion: reduce) {
  .sz-window,
  .sz-window.sz-minimizing,
  .sz-window.sz-restoring-from-min,
  .sz-window.sz-restoring-from-max,
  .sz-window.sz-maximizing,
  .sz-window.sz-focus-pulse,
  #sz-start-menu.open,
  #sz-start-menu.closing {
    animation-duration: 0.01ms !important;
  }

  .sz-icon,
  .sz-taskbar-button {
    transition-duration: 0.01ms !important;
  }
}
